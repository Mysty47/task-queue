üìÑ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: –†–∞–±–æ—Ç–∞, OS —Ñ—É–Ω–∫—Ü–∏–∏, –°–∫–æ—Ä–æ—Å—Ç –∏ Reflection

üß† –ö–∞–∫ —Ä–∞–±–æ—Ç–∏ –ø—Ä–æ–≥—Ä–∞–º–∞—Ç–∞
–ü—Ä–æ–≥—Ä–∞–º–∞—Ç–∞ —Ä–µ–∞–ª–∏–∑–∏—Ä–∞ –∫–æ–º—É–Ω–∏–∫–∞—Ü–∏—è –º–µ–∂–¥—É –ø—Ä–æ—Ü–µ—Å–∏ –ø–æ —à–∞–±–ª–æ–Ω–∞ Producer ‚Äì Consumer, –∫—ä–¥–µ—Ç–æ:

- producer.c —Å—Ç–∞—Ä—Ç–∏—Ä–∞ TCP —Å—ä—Ä–≤—ä—Ä (–Ω–∞ –ø–æ—Ä—Ç 12345), –∫–æ–π—Ç–æ –ø—Ä–∏–µ–º–∞ –≤—Ä—ä–∑–∫–∏ –æ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–æ –∫–ª–∏–µ–Ω—Ç–∏ (workers).

- –í—Å–µ–∫–∏ –Ω–æ–≤ consumer.c —Å–µ —Å–≤—ä—Ä–∑–≤–∞ —Å—ä—Å —Å—ä—Ä–≤—ä—Ä–∞ –∏ –∑–∞–ø–æ—á–≤–∞ –¥–∞ –ø–æ–ª—É—á–∞–≤–∞ —á–∏—Å–ª–æ–≤–∏ –∑–∞–¥–∞—á–∏ (int), –∫–æ–∏—Ç–æ –æ–±—Ä–∞–±–æ—Ç–≤–∞ –≤–µ–¥–Ω–∞–≥–∞.

- –ó–∞–¥–∞—á–∏—Ç–µ —Å–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª–Ω–∏ —Ü–µ–ª–∏ —á–∏—Å–ª–∞ (0, 1, 2, ...), –∫–∞—Ç–æ –≤—Å–µ–∫–∏ task —Å–µ –∏–∑–ø—Ä–∞—â–∞ –¥–æ –≤—Å–∏—á–∫–∏ —Å–≤—ä—Ä–∑–∞–Ω–∏ consumers.

- –ü—Ä–æ–≥—Ä–∞–º–∞—Ç–∞ —Ä–∞–±–æ—Ç–∏ –Ω–µ–ø—Ä–µ–∫—ä—Å–Ω–∞—Ç–æ, –¥–æ–∫–∞—Ç–æ –Ω–µ –±—ä–¥–µ –ø—Ä–µ–∫—ä—Å–Ω–∞—Ç–∞ —Ä—ä—á–Ω–æ. –í—Å–µ–∫–∏ worker (consumer) —Å–µ —Å—Ç–∞—Ä—Ç–∏—Ä–∞ –æ—Ç–¥–µ–ª–Ω–æ –æ—Ç –∫–æ–Ω–∑–æ–ª–∞—Ç–∞.

‚öôÔ∏è –ò–∑–ø–æ–ª–∑–≤–∞–Ω–∏ —Å–∏—Å—Ç–µ–º–Ω–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ –∑–∞—â–æ:

- –ò–∑–ø–æ–ª–∑–≤–∞–Ω–∏ —Å–∞ —Ñ—É–Ω–∫—Ü–∏–∏ –æ—Ç Windows Sockets API (Winsock) –∑–∞ —Ä–µ–∞–ª–∏–∑–∏—Ä–∞–Ω–µ –Ω–∞ –∫–æ–º—É–Ω–∏–∫–∞—Ü–∏—è—Ç–∞:

- WSAStartup, socket, bind, listen, accept, connect, send, recv ‚Äì –∑–∞ —Å—ä–∑–¥–∞–≤–∞–Ω–µ –Ω–∞ TCP —Å—ä—Ä–≤—ä—Ä (producer) –∏ TCP –∫–ª–∏–µ–Ω—Ç (consumer).

- select() ‚Äì –∏–∑–ø–æ–ª–∑–≤–∞–Ω –∑–∞ –Ω–µ–±–ª–æ–∫–∏—Ä–∞—â–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞ –Ω–æ–≤–∏ –≤—Ä—ä–∑–∫–∏ (–Ω–æ–≤–∏ consumers), –±–µ–∑ –¥–∞ –±–ª–æ–∫–∏—Ä–∞ –∏–∑–ø—Ä–∞—â–∞–Ω–µ—Ç–æ –Ω–∞ –∑–∞–¥–∞—á–∏.

- closesocket, WSACleanup ‚Äì –∑–∞ –æ—Å–≤–æ–±–æ–∂–¥–∞–≤–∞–Ω–µ –Ω–∞ —Ä–µ—Å—É—Ä—Å–∏ —Å–ª–µ–¥ –ø—Ä–∏–∫–ª—é—á–≤–∞–Ω–µ –Ω–∞ —Ä–∞–±–æ—Ç–∞.

- –ò–∑–ø–æ–ª–∑–≤–∞–Ω–µ—Ç–æ –Ω–∞ –Ω–µ–±–ª–æ–∫–∏—Ä–∞—â —Å–æ–∫–µ—Ç —Å—ä—Ä–≤—ä—Ä –±–µ–∑ –Ω–∏—à–∫–∏ –æ—Ç–≥–æ–≤–∞—Ä—è –Ω–∞ –∏–∑–∏—Å–∫–≤–∞–Ω–µ—Ç–æ –∑–∞ –º–∞–∫—Å–∏–º–∞–ª–Ω–æ –±—ä—Ä–∑ producer. –í—Å–µ–∫–∏ –∫–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–≤–∞ –∑–∞–¥–∞—á–∏ —á—Ä–µ–∑ –µ–¥–∏–Ω —Ü–∏–∫—ä–ª, –∫–∞—Ç–æ –Ω–µ —Å–µ –∏–∑–ø–æ–ª–∑–≤–∞—Ç —Ç—Ä–µ–¥–æ–≤–µ –∑–∞ –∏–∑–ø—Ä–∞—â–∞–Ω–µ.

üöÄ –û–±–æ—Å–Ω–æ–≤–∫–∞ –Ω–∞ –ø–æ—Å—Ç–∏–≥–Ω–∞—Ç–∞—Ç–∞ —Å–∫–æ—Ä–æ—Å—Ç:

Producer:
- –°—Ä–µ–¥–Ω–∞ —Å–∫–æ—Ä–æ—Å—Ç: ~33,000 –∑–∞–¥–∞—á–∏/—Å–µ–∫—É–Ω–¥–∞

- –ú–∏–Ω–∏–º–∞–ª–Ω–æ –≤—Ä–µ–º–µ –Ω–∞ –∑–∞–¥–∞—á–∞: 0.0161 ms

- –°–∫–æ—Ä–æ—Å—Ç—Ç–∞ —Å–µ –∏–∑–º–µ—Ä–≤–∞ –Ω–∞ –≤—Å–µ–∫–∏ 10,000 –∑–∞–¥–∞—á–∏, –∏ —Å–µ –æ—Ç–ø–µ—á–∞—Ç–≤–∞ –Ω–∞ –∫–æ–Ω–∑–æ–ª–∞—Ç–∞.

Consumer:
- –°—Ä–µ–¥–Ω–∞ —Å–∫–æ—Ä–æ—Å—Ç: ~33,000 ‚Äì 59,000 –∑–∞–¥–∞—á–∏/—Å–µ–∫—É–Ω–¥–∞

- –û–±—Ä–∞–±–æ—Ç–∫–∞—Ç–∞ –Ω–∞ –∑–∞–¥–∞—á–∏—Ç–µ –µ –º–∏–≥–Ω–æ–≤–µ–Ω–∞ (0 –≤—Ä–µ–º–µ –∑–∞ –∏–∑–ø—ä–ª–Ω–µ–Ω–∏–µ), —Ç–∞–∫–∞ —á–µ —Å–µ –º–µ—Ä–∏ —Å–∞–º–æ —Å–∫–æ—Ä–æ—Å—Ç—Ç–∞ –Ω–∞ –ø–æ–ª—É—á–∞–≤–∞–Ω–µ.

- –ü–æ–∫–∞–∑–≤–∞ —Å–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –Ω–∞ –≤—Å–µ–∫–∏ 100,000 –∑–∞–¥–∞—á–∏.

–§–∞–∫—Ç–æ—Ä–∏ –∑–∞ –¥–æ–±—Ä–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–Ω–æ—Å—Ç:
- –ò–∑–ø–æ–ª–∑–≤–∞–Ω–µ –Ω–∞ send() —Å –¥–∏—Ä–µ–∫—Ç–µ–Ω int (4 –±–∞–π—Ç–∞) –±–µ–∑ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è.

- –ù–µ —Å–µ –∏–∑–ø–æ–ª–∑–≤–∞ printf() –Ω–∞ –≤—Å—è–∫–∞ –∑–∞–¥–∞—á–∞ ‚Äì —Å–∞–º–æ –ø—Ä–µ–∑ 10k/100k.

- –ë–µ–∑ –Ω–∏—à–∫–∏ ‚Äì —Ü–µ–ª–∏—è—Ç producer –µ –≤ –µ–¥–∏–Ω –Ω–µ–±–ª–æ–∫–∏—Ä–∞—â main loop —Å select().

- –†–∞–±–æ—Ç–∞ –Ω–∞ 127.0.0.1 ‚Äì –±–µ–∑ –º—Ä–µ–∂–æ–≤–∞ –ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç.

‚úçÔ∏è Reflection
- –†–∞–±–æ—Ç–∞—Ç–∞ –ø–æ –∑–∞–¥–∞—á–∞—Ç–∞ –º–∏ –¥–∞–¥–µ —Ä–µ–∞–ª–µ–Ω –æ–ø–∏—Ç —Å TCP —Å–æ–∫–µ—Ç–∏ –≤ C –∏ –Ω–∞—É—á–∏—Ö –∫–∞–∫ –¥–∞ –Ω–∞–ø—Ä–∞–≤—è –µ—Ñ–µ–∫—Ç–∏–≤–Ω–∞ –∫–æ–º—É–Ω–∏–∫–∞—Ü–∏—è –º–µ–∂–¥—É –ø—Ä–æ—Ü–µ—Å–∏.

–ù–∞–π-–ø–æ–ª–µ–∑–Ω–æ:
- –ù–∞—É—á–∏—Ö –∫–∞–∫ –¥–∞ —Ä–∞–±–æ—Ç—è —Å select() –∑–∞ –Ω–µ–±–ª–æ–∫–∏—Ä–∞—â–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ –Ω–æ–≤–∏ –∫–ª–∏–µ–Ω—Ç–∏ –±–µ–∑ –Ω–∏—à–∫–∏.

- –†–∞–∑–±—Ä–∞—Ö –∫–∞–∫ –¥–∞ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–∞–º producer-–∞ –¥–∞ –Ω–µ —Å–µ –±–∞–≤–∏, –¥–æ—Ä–∏ –∫–æ–≥–∞—Ç–æ –∏–º–∞ –º–Ω–æ–≥–æ clients.

–ù–∞–π-—Ç—Ä—É–¥–Ω–æ:
- –£—Å–ø—è—Ö –¥–∞ –Ω–∞–ø—Ä–∞–≤—è producer-–∞ –Ω–∞–∏—Å—Ç–∏–Ω–∞ –Ω–µ–±–ª–æ–∫–∏—Ä–∞—â –±–µ–∑ –Ω–∏—Ç–æ –µ–¥–Ω–∞ –Ω–∏—à–∫–∞ ‚Äì —Ç–æ–≤–∞ –±–µ—à–µ –Ω–∞–π-–ø—Ä–µ–¥–∏–∑–≤–∏–∫–∞—Ç–µ–ª–Ω–æ –∏ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª–Ω–æ.

‚úÖ –°–∏—Å—Ç–µ–º–∞—Ç–∞ —Ä–∞–±–æ—Ç–∏ —Å—Ç–∞–±–∏–ª–Ω–æ, producer –µ –Ω–µ–±–ª–æ–∫–∏—Ä–∞—â, –∑–∞–¥–∞—á–∏—Ç–µ —Å–µ —Ä–∞–∑–¥–∞–≤–∞—Ç –Ω–∞ –≤—Å–∏—á–∫–∏ –∫–ª–∏–µ–Ω—Ç–∏, –∏ —Å–∫–æ—Ä–æ—Å—Ç—Ç–∞ –µ —Å—ä–ø–æ—Å—Ç–∞–≤–∏–º–∞ —Å –æ—Å—Ç–∞–Ω–∞–ª–∏—Ç–µ —Ä–µ—à–µ–Ω–∏—è.